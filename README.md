# **VRChat 履歴・アバター変更 統合アプリケーション**

## **概要**

このアプリケーションは、VRChatでのアバターやワールドの変更履歴を自動でGoogleスプレッドシートに記録し、GUI上から履歴の閲覧、画像の確認、任意のアバターへの変更ができる統合ツールです。

VRChatクライアントから送信されるOSC（Open Sound Control）メッセージを監視し、アバターやワールドが変更されると、VRChat APIを通じて詳細情報を取得してスプレッドシートに記録します。

## **主な機能**

* **履歴の自動記録**: VRChat内でアバターやワールドを変更すると、OSCでそれを検知し、Googleスプレッドシートに自動で記録します。  
* **詳細情報取得**: VRChat APIを利用して、アバターやワールドの名前、作者、サムネイル画像などの詳細情報を取得します。  
* **GUIでの履歴閲覧**: 記録した履歴をGUI（グラフィカル・ユーザー・インターフェース）上のリストで分かりやすく表示します。  
* **画像プレビュー**: 履歴リストで選択したアイテムのサムネイル画像を表示します。画像はローカルにキャッシュされ、次回以降の表示が高速になります。  
* **アバター変更機能**: GUIの履歴リストからアバターを選択し、ボタン一つでVRChatクライアント内のアバターを変更できます。  
* **自動ログイン**: 一度ログインすると認証情報（クッキー）をファイルに保存し、次回以降は自動でログインします。  
* **2FA（二段階認証）対応**: 二段階認証が有効なアカウントでもログインできます。

## **動作環境**

このスクリプトを実行するには、Python 3と以下のライブラリが必要です。

* gspread  
* google-auth-oauthlib  
* vrchatapi  
* python-osc  
* Pillow  
* requests

以下のコマンドで必要なライブラリをまとめてインストールできます。

pip install gspread google-auth-oauthlib vrchatapi python-osc Pillow requests

## **事前準備**

このアプリケーションを使用するには、いくつかの事前準備が必要です。

### **1\. Google Cloud Platform (GCP) の設定**

履歴を記録するためにGoogleスプレッドシートを操作するサービスアカウントを設定します。

1. **GCPプロジェクトの作成**: [Google Cloud Console](https://console.cloud.google.com/)にアクセスし、新しいプロジェクトを作成します。  
2. **APIの有効化**: 作成したプロジェクトで、以下の2つのAPIを有効にします。  
   * **Google Drive API**  
   * **Google Sheets API**  
3. **サービスアカウントの作成**:  
   * \[IAMと管理\] \> \[サービスアカウント\] に移動し、新しいサービスアカウントを作成します。  
   * アカウントに適切な名前を付け、「作成して続行」をクリックします。  
   * ロールは不要なので、「続行」をクリックします。  
   * 「完了」をクリックしてサービスアカウントの作成を完了します。  
4. **JSONキーの生成とダウンロード**:  
   * 作成したサービスアカウントのメールアドレスをクリックします。  
   * 「キー」タブに移動し、「鍵を追加」\>「新しい鍵を作成」を選択します。  
   * キーのタイプとして「**JSON**」を選択し、「作成」をクリックします。  
   * キーファイル（JSON形式）が自動的にダウンロードされます。このファイルを後で使用します。

### **2\. Google スプレッドシートの準備**

1. **スプレッドシートの作成**: 履歴を記録するためのGoogleスプレッドシートを新規に作成します。  
2. **サービスアカウントとの共有**:  
   * 作成したスプレッドシートの右上の「共有」ボタンをクリックします。  
   * GCPでダウンロードしたJSONキーファイル内に記載されている client\_email のメールアドレス（例: my-account@my-project-name.iam.gserviceaccount.com）を共有相手として追加します。  
   * 権限を「**編集者**」に設定して保存します。

### **3\. スクリプトの設定**

1. ダウンロードしたサービスアカウントのJSONキーファイルを、この vrc\_integrated\_app.py スクリプトと同じディレクトリに配置します。  
2. vrc\_integrated\_app.py をテキストエディタで開き、以下の定数を自分の環境に合わせて編集します。

\# \--- 設定 \---  
\# Google Sheets 設定  
\# ダウンロードしたサービスアカウントのJSONキーファイルへのパス  
SERVICE\_ACCOUNT\_KEY\_FILE \= 'your-service-account-key.json' \# \<-- ★ここを自分のJSONファイル名に書き換えてください★  
\# スプレッドシートの名前 (履歴保存用とGUI読み込み用を兼ねる)  
SPREADSHEET\_NAME \= 'VRCAPI' \# \<-- ★使用するスプレッドシート名に書き換えてください★  
\# ワークシートの名前 (履歴を記録・読み込みするシート)  
WORKSHEET\_NAME \= 'API' \# \<-- ★使用するワークsheet名に書き換えてください★

## **使用方法**

1. **VRChatの設定**:  
   * VRChatを起動し、Action Menuを開きます。  
   * Options \> OSC \> Enabled にしてOSCを有効にします。  
2. **アプリケーションの起動**:  
   * ターミナルまたはコマンドプロンプトで、以下のコマンドを実行してアプリケーションを起動します。  
     python vrc\_integrated\_app.py

3. **ログイン**:  
   * 初回起動時、または自動ログインに失敗した場合は、GUIに表示されるログイン画面でVRChatのユーザー名とパスワードを入力してログインします。  
   * 二段階認証（2FA）が有効な場合は、コード入力欄が表示されるので、認証アプリ等で生成されたコードを入力して「検証」ボタンを押してください。  
   * ログインに成功すると、認証クッキーが vrc\_auth\_cookie.lwp というファイルに保存され、次回からは自動でログインします。  
4. **履歴の確認とアバターの変更**:  
   * ログイン後、VRChat内でアバターやワールドを変更すると、自動的に検知され、アプリの履歴リストが更新されます。  
   * 履歴リストの項目をクリックすると、右側のパネルにそのアイテムの画像が表示されます。  
   * 履歴リストで種類が「Avatar」の項目を選択した状態で「**このアバターに変更**」ボタンをクリックすると、VRChatクライアント内のアバターがそのアバターに変更されます。  
5. **アプリケーションの終了**:  
   * ウィンドウの「閉じる」ボタンをクリックすると確認ダイアログが表示され、「OK」を押すと安全にアプリケーションを終了します。

## **注意事項**

* VRChat APIにはレートリミット（短時間でのアクセス回数制限）があります。頻繁な操作はAPIエラーの原因となる可能性があるため、避けてください。  
* 認証クッキーは vrc\_auth\_cookie.lwp というファイル名でローカルに保存されます。このファイルが第三者に漏洩すると、あなたのアカウントに不正アクセスされる可能性があります。取り扱いには十分注意してください。  
* エラーが発生した場合、コマンドプロンプトやターミナルに詳細なログが出力されます。問題が発生した際は、そのログを参考にしてください。
