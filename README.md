# **VRChat History Tracker (VRC履歴トラッカー)**

このアプリケーションは、VRChatでのアバターの変更履歴を自動でGoogleスプレッドシートに記録し、GUI上から履歴の閲覧、画像の確認、任意のアバターへの変更ができる統合ツールです。  
VRChatクライアントから送信されるOSC（Open Sound Control）メッセージを監視し、アバターが変更されると、VRChat APIを通じて詳細情報を取得してスプレッドシートに記録します。

## **主な機能**

* **履歴の自動記録**: VRChat内でアバターを変更すると、OSCでそれを検知し、Googleスプレッドシートに自動で記録します。  
* **詳細情報取得**: VRChat APIを利用して、アバターの名前、作者、サムネイル画像などの詳細情報を取得します。  
* **GUIでの履歴閲覧**: 記録した履歴をGUI上のリストで分かりやすく表示します。  
* **画像プレビュー**: 履歴リストで選択したアイテムのサムネイル画像を表示します。画像はローカルにキャッシュされ、次回以降の表示が高速になります。  
* **アバター変更機能**: GUIの履歴リストからアバターを選択し、ボタン一つでVRChatクライアント内のアバターを変更できます。  
* **自動ログイン**: 一度ログインすると認証情報をファイルに保存し、次回以降は自動でログインします。  
* **2FA（二段階認証）対応**: 二段階認証が有効なアカウントでもログインできます。

## **セットアップ手順**

### **1\. Google Cloud Platform (GCP) の設定**

履歴を記録するためにGoogleスプレッドシートを操作するサービスアカウントを設定します。

1. **GCPプロジェクトの作成**: [Google Cloud Console](https://console.cloud.google.com/)にアクセスし、新しいプロジェクトを作成します。  
2. **APIの有効化**: 作成したプロジェクトで、以下の2つのAPIを有効にします。  
   * Google Drive API  
   * Google Sheets API  
3. **サービスアカウントの作成**:  
   1. \[IAMと管理\] \> \[サービスアカウント\] に移動し、新しいサービスアカウントを作成します。  
   2. アカウントに適切な名前を付け、「作成して続行」をクリックします。  
   3. ロールは不要なので、「続行」をクリックします。  
   4. 「完了」をクリックしてサービスアカウントの作成を完了します。  
4. **JSONキーの生成とダウンロード**:  
   1. 作成したサービスアカウントのメールアドレスをクリックします。  
   2. 「キー」タブに移動し、「鍵を追加」 \> 「新しい鍵を作成」を選択します。  
   3. キーのタイプとして「JSON」を選択し、「作成」をクリックします。  
   4. キーファイル（JSON形式）が自動的にダウンロードされます。このファイルを後ほど使用します。

### **2\. Google スプレッドシートの準備**

1. **スプレッドシートの作成**: 履歴を記録するためのGoogleスプレッドシートを新規に作成します。  
2. **サービスアカウントとの共有**:  
   1. 作成したスプレッドシートの右上の「共有」ボタンをクリックします。  
   2. GCPでダウンロードしたJSONキーファイル内に記載されている client\_email のメールアドレス（例: my-account@my-project-name.iam.gserviceaccount.com）を共有相手として追加します。  
   3. 権限を「編集者」に設定して保存します。

### **3\. 設定ファイルの編集**

1. ダウンロードしたサービスアカウントのJSONキーファイルを、vrc\_integrated\_app.exe と同じディレクトリに配置します。  
2. 同じディレクトリにある config.ini ファイルをテキストエディタで開き、ご自身の環境に合わせて編集します。

\[GoogleSheets\]

\# 使用するGoogleサービスアカウントのキーファイル名（.json）  
ServiceAccountKeyFile \= your-service-account-key.json \# \<-- ★ここを自分のJSONファイル名に書き換えてください★

\# 接続するGoogleスプレッドシートの名前  
SpreadsheetName \= VRCAPI \# \<-- ★使用するスプレッドシート名に書き換えてください★

\# 履歴を記録するワークシートの名前  
WorksheetName \= API \# \<-- ★使用するワークシート名に書き換えてください★

## **使用方法**

1. **VRChatの設定**:  
   1. VRChatを起動し、Action Menuを開きます。  
   2. Options \> OSC \> Enabled にしてOSCを有効にします。  
2. **初回ログインと認証ファイル作成 (2FA対応)**  
   * **重要**: このアプリケーションを初めて使う場合や、2段階認証(2FA)を有効にしている場合は、まず認証ファイルを作成する必要があります。  
   * ターミナルで python login.py を実行してください。  
   * 表示された画面でユーザー名、パスワード、(必要な場合は)2FAコードを入力してログインします。  
   * 成功すると、vrc\_auth\_cookie.lwp という認証ファイルが生成されます。  
3. **アプリケーションの起動**  
   * vrc\_auth\_cookie.lwp ファイルがある状態で vrc\_integrated\_app.exe をダブルクリックすると、自動でログインしてメイン画面が起動します。  
   * **(注意)** vrc\_auth\_cookie.lwp が無い場合、vrc\_integrated\_app.exe はログイン画面を表示しますが、ログインしても正常に動作しません、**2段階認証(2FA)は利用できません。**  
4. **履歴の確認とアバターの変更**:  
   * ログイン後、VRChat内でアバターを変更すると、自動的に検知され、アプリの履歴リストが更新されます。  
   * 履歴リストの項目をクリックすると、右側のパネルにそのアイテムの画像が表示されます。  
   * 履歴リストで種類が「Avatar」の項目を選択した状態で「このアバターに変更」ボタンをクリックすると、VRChatクライアント内のアバターがそのアバターに変更されます。  
5. **ログアウト方法**:  
   * アプリケーションを完全に終了させた後、vrc\_auth\_cookie.lwp ファイルを手動で削除してください。  
6. **アプリケーションの終了**:  
   * ウィンドウの「閉じる」ボタンをクリックすると確認ダイアログが表示され、「OK」を押すと安全にアプリケーションを終了します。

## **アプリケーションの構成**

* **vrc\_integrated\_app.exe**: メインの実行ファイルです。vrc\_auth\_cookie.lwp があれば自動ログインします。無い場合は一時的なログイン画面（2FA不可）**正常に動作しません**を表示します。  
* **login.py (ソースコード)**: **認証ファイル(vrc\_auth\_cookie.lwp)を生成するための専用スクリプトです。アプリを利用する場合は初回のみ、このスクリプトを実行する必要があります。**  
* **config.ini**: Googleスプレッドシートの接続情報などを格納する設定ファイルです。  
* **vrc\_auth\_cookie.lwp**: ログイン成功時に生成される認証クッキーファイルです。このファイルがあることで次回以降の起動時に自動でログインできます。このファイルを削除するとログアウト状態になります。

## **注意事項**

* VRChat APIにはレートリミット（短時間でのアクセス回数制限）があります。頻繁な操作はAPIエラーの原因となる可能性があるため、避けてください。  
* 認証クッキーは vrc\_auth\_cookie.lwp というファイル名でローカルに保存されます。このファイルが第三者に漏洩すると、あなたのアカウントに不正アクセスされる可能性があります。取り扱いには十分注意してください。
